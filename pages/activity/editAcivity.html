<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <title>商家后台管理</title>
    <link rel="stylesheet" href="../../layui/css/layui.css?t=2" media="all">
    <link rel="stylesheet" href="../../assets/css/common.css?t=2" media="all">
    <link rel="stylesheet" href="../../assets/css/activity.css" media="all">
    <style type="text/css">
        .sel, .sel-address {
            width: 100%;
            height: 100%;
        }

        .add-activity {
            height: 50px;
            padding-top: 10px;
        }

        .add-activity button {
            float: right;
        }

    </style>
</head>
<style type="text/css" id="LAY_layadmin_theme"></style>
<body>
<div class="layui-fluid">
    <div class="add-activity">
        <button type="button" data-id="b" onclick="editActivity()" class="layui-btn layui-btn-normal">添加</button>
    </div>

    <div class="layui-form">
        <table class="layui-table">
            <colgroup>
                <col width="150">
                <col width="150">
                <col width="200">
                <col>
            </colgroup>
            <thead>
            <tr>
                <th>图片</th>
                <th>名称</th>
                <th>类型</th>
                <th>日期</th>
                <th>地点</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>
                    <img class="activity-img" src="http://www.bbvdd.com/d/2019052313434523h.png" alt="">
                </td>
                <td>3-6岁教育</td>
                <td>儿童教育</td>
                <td>5/23</td>
                <td>浦江镇</td>
                <td class="operation">
                    <button type="button" data-id="a" onclick="editActivity()" class="layui-btn layui-btn-normal edit">编辑</button>
                    <button type="button" onclick="deleteActivity(this)" class="layui-btn layui-btn-primary delete">删除</button>
                </td>
            </tr>
            <tr>
                <td>
                    <img class="activity-img" src="http://www.bbvdd.com/d/2019052313434523h.png" alt="">
                </td>
                <td>3-6岁教育</td>
                <td>儿童教育</td>
                <td>5/23</td>
                <td>浦江镇</td>
                <td class="operation">
                    <button type="button" data-id="b" onclick="editActivity()" class="layui-btn layui-btn-normal edit">编辑</button>
                    <button type="button" onclick="deleteActivity(this)" class="layui-btn layui-btn-primary delete">删除</button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
<!--    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">-->
<!--        <legend>总页数低于页码总数</legend>-->
<!--    </fieldset>-->
<!--    <div id="demo20"></div>-->
<!--    <ul id="biuuu_city_list"></ul>-->
</div>

<!--编辑活动模态框-->
<div id="edit-modal" style="display: none;">
    <form class="content layui-form" id="company">
        <div class="scroll-content">
            <div class="item">
                <label id="test1">上传图片</label>
    <!--            <div class="layui-upload-list">-->
    <!--                <img class="layui-upload-img" id="demo1" name="img">-->
    <!--                <p id="demoText"></p>-->
    <!--            </div>-->
                <div class="layui-upload-list" id="upload">
                    <img class="layui-upload-img" alt="" id="img" name="file">
                </div>
                <input type="file" id="file" name="file" style="display: none">
                <input type="text" name="which" id="which" value="" style="display: none">
            </div>
            <div class="item">
                <label>名称</label>
                <input autocomplete="off" id="name" type="text" name="title" placeholder="请输入名称">
            </div>
            <div class="item">
                <label>活动类型</label>
<!--                <input autocomplete="off" type="text" id="type" name="activityTypeId" placeholder="请输入类型">-->
                <div class="layui-input-inline">
                    <select name="activityTypeId" class="sel" lay-verify="required" lay-search="">
                        <option value="">直接选择或搜索选择</option>
                        <option value="1">layer</option>
                        <option value="2">form</option>
                        <option value="3">layim</option>
                        <option value="4">element</option>
                        <option value="5">laytpl</option>
                        <option value="6">upload</option>
                        <option value="7">laydate</option>
                        <option value="8">laypage</option>
                        <option value="9">flow</option>
                        <option value="10">util</option>
                        <option value="11">code</option>
                        <option value="12">tree</option>
                        <option value="13">layedit</option>
                        <option value="14">nav</option>
                        <option value="15">tab</option>
                        <option value="16">table</option>
                        <option value="17">select</option>
                        <option value="18">checkbox</option>
                    </select>
                </div>
            </div>
            <div class="item">
                <label>副标题</label>
                <input autocomplete="off" type="text" id="subtitle" name="subtitle" placeholder="请输入副标题">
            </div>
            <div class="item">
                <label>价格</label>
                <input autocomplete="off" type="text" id="price" name="price" placeholder="请输入价格">
            </div>
            <div class="item">
                <label>日期</label>
                <div class="layui-input-inline " style="display: flex;">
                    <input autocomplete="off" type="text" name="hostingDatetime" class="layui-input" id="test12" placeholder="yyyy/MM/dd" style="width: 45%;margin-right: 20px;">
                    <input autocomplete="off" type="text" name="hostingEndDatetime" class="layui-input" id="test13" placeholder="yyyy/MM/dd" style="width: 45%">
                </div>
            </div>
            <div class="item">
                <label>地址</label>
<!--                <input autocomplete="off" type="text" id="address" name="venue" placeholder="请输入地点(如：省-市-区-镇/乡)">-->
                <div class="layui-input-inline">
                    <select name="venue" id="address" class="sel" lay-verify="required" lay-search="">
                        <option value="">直接选择或搜索选择</option>
                        <option value="浦东新区">浦东新区</option>
                        <option value="闵行区">闵行区</option>
                        <option value="徐汇区">徐汇区</option>
                        <option value="静安区">静安区</option>
                        <option value="普陀区">普陀区</option>
                        <option value="杨浦区">杨浦区</option>
                        <option value="黄浦区">黄浦区</option>
                        <option value="虹口区">虹口区</option>
                        <option value="嘉定区">嘉定区</option>
                        <option value="松江区">松江区</option>
                        <option value="宝山区">宝山区</option>
                        <option value="青浦区">青浦区</option>
                        <option value="奉贤区">奉贤区</option>
                        <option value="金山区">金山区</option>
                        <option value="崇明区">崇明区</option>
                        <option value="崇明县">崇明县</option>
                    </select>
                </div>
            </div>
            <div class="item">
                <label>详细地址</label>
                <input autocomplete="off" type="text" id="addressdetail" name="venues" placeholder="请输入详细地址">
            </div>
            <div style="padding: 10px 0;">活动详情：</div>
            <input type="text" name="descript" value="" id="descript" style="display: none;">
            <textarea id="demos" name="demos" style="display: none"></textarea>

            <div style="height: 80px;padding-top: 20px;">
                <div type="button" onclick="submit()" class="layui-btn layui-btn-normal save">保存</div>
            </div>

        </div>
    </form>
</div>
</body>
<script type="text/javascript" src="../../assets/js/jquery.min.js"></script>
<script type="text/javascript" src="../../layui/layui.js?t=2"></script>
<script type="text/javascript" src="../../assets/js/common.js?t=2"></script>
<script type="text/javascript" src="../../assets/js/activity.js"></script>
<script type="text/javascript">
    // layui.use(['laypage', 'layer'], function() {
    //     var laypage = layui.laypage,
    //         layer = layui.layer;
    //     // laypage.render({
    //     //     elem: 'demo1'
    //     //     ,count: 60 //数据总数
    //     //     ,jump: function(obj){
    //     //         console.log(obj)
    //     //     }
    //     // });
    //
    //     var data = [
    //         '北京',
    //         '上海',
    //         '广州',
    //         '深圳',
    //         '杭州',
    //         '长沙',
    //         '合肥',
    //         '宁夏',
    //         '成都',
    //         '西安',
    //         '南昌',
    //         '上饶',
    //         '沈阳',
    //         '济南',
    //         '厦门',
    //         '福州',
    //         '九江',
    //         '宜春',
    //         '赣州',
    //         '宁波',
    //         '绍兴',
    //         '无锡',
    //         '苏州',
    //         '徐州',
    //         '东莞',
    //         '佛山',
    //         '中山',
    //         '成都',
    //         '武汉',
    //         '青岛',
    //         '天津',
    //         '重庆',
    //         '南京',
    //         '九江',
    //         '香港',
    //         '澳门',
    //         '台北'
    //     ];
    //
    //     //调用分页
    //     laypage.render({
    //         elem: 'demo20'
    //         ,count: data.length
    //         ,limit: 10
    //         ,jump: function(obj){
    //             //模拟渲染
    //             document.getElementById('biuuu_city_list').innerHTML = function(){
    //                 var arr = []
    //                     ,thisData = data.concat().splice(obj.curr*obj.limit - obj.limit, obj.limit);
    //                 console.log(obj.curr)
    //                 console.log(obj.curr*obj.limit - obj.limit)
    //                 layui.each(thisData, function(index, item){
    //                     arr.push('<li>'+ item +'</li>');
    //                 });
    //                 return arr.join('');
    //             }();
    //         }
    //     });
    // })
    $(function(){
        // $(".layui-input").val('徐汇区')

        // $("option[value='宝山区']").attr("selected", '')

        // console.log($(".layui-this").text('徐汇'))
    })
    var content;
    var layedit;

    //编辑活动
    function editActivity(){
        // $("[name='testname']").val("xxxxxxxxxxxxxxx");//向模态框中赋值
        layui.use(['layer'],function () {
            var layer = layui.layer,$=layui.$;
            layer.open({
                type:1,//类型
                area:['500px','540px'],//定义宽和高
                title:'编辑活动',//题目
                shadeClose:false,//点击遮罩层关闭
                content: $('#edit-modal'),//打开的内容
            });
            // $("#name").val('1111')
        })

        // 富文本编辑器
        //初始化富文本框
        layui.use('layedit', function () {
            layedit = layui.layedit;
            layedit.set({
                uploadImage: {
                    url: 'http://192.168.2.173/apis/activity/activity/upload_image',
                    type: 'post'
                }
            });
            content = layedit.build('demos');
        });
    }
    //上传图片
    $("#upload").click(function() {
        $("#file").trigger("click");
        //   按钮已隐藏  点击div upload如点击file按钮
    });
    $('#file').change(function () {
        var imgs = $('#file').get(0).files[0];
        var src=window.URL.createObjectURL(imgs);
        $("#img").attr("src",src);
        var formData = new FormData();//新建一个formData来储存需要传递的信息
        formData.append('upload_file', imgs);//需要传递的字段image路径
        var which = Math.floor(Math.random () * 900) + 100
        console.log(which)
        formData.append('which', which);//id
        $("#which").val(which)
        $.ajax({
            type: 'post',
            url: 'http://192.168.2.173/apis/activity/activity/upload_image',
            // headers: {
            //     'yl-authorization': obj.mobile
            // },
            data: formData,
            contentType:false,
            processData:false,
            dataType: 'json',
            success: function (data) {
                layer.msg('上传成功');
                $("#which").val(which)
            },
            error: function () {
                layer.msg('上传失败');
            }
        });
    });
    //保存编辑活动
    function submit() {
        console.log('******')
        console.log(decodeURIComponent($(".content").serialize(),true))
        var name = $("#name").val()
        var price = $("#price").val()
        var type = $(".sel").val()
        var date = $("#test12").val()
        var datend = $("#test13").val()
        var subtitle = $("#subtitle").val()
        var address = $("#address").val()
        var addressdetail = $("#addressdetail").val()
        var amtreg=/^\d+(\.\d{1,2})?$/;
        console.log(layedit.getContent(content))
        $("#descript").val(layedit.getContent(content))
        if($("#which").val() == '') {
            layer.msg('请上传图片');
        }else if (name == "" || name == null) {
            layer.msg('请输入名称');
        } else if (type == "" || type == null) {
            layer.msg('请输入类型');
        } else if (subtitle == "" || subtitle == null) {
            layer.msg('请输入副标题');
        } else if (!amtreg.test(price)) {
            layer.msg('请输入正确的价格');
        } else if (date == "" || date == null) {
            layer.msg('请输入开始日期');
        } else if (datend == "" || datend == null) {
            layer.msg('请输入结束日期');
        } else if (address == "" || address == null) {
            layer.msg('请输入地址');
        }else if (addressdetail == "" || addressdetail == null) {
            layer.msg('请输入详细地址');
        } else {
            // layer.closeAll(); //关闭弹框
            console.log(decodeURIComponent($("#company").serialize(),true))
            // $.ajax({
            //     // contentType: 'application/json',
            //     xhrFields: {
            //         withCredentials: true
            //     },
            //     type:"post",
            //     url:"http://192.168.2.173/apis/activity/activity/upload_activity",
            //     data: decodeURIComponent($("#company").serialize(),true),
            //     crossDomain: true,

            //     success:function(data){
            //         console.log('***********')
            //         console.log(data);
            //         layer.msg('保存成功');
            //         layer.closeAll();
            //     },
            //     error:function(){
            //         console.log('失败');
            //         layer.msg('保存失败');
            //     }
            // });
        }
    }
</script>
</html>